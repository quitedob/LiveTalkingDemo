<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能语音助手控制面板</title>
    <!-- 引入外部CSS样式文件 -->
    <link rel="stylesheet" href="demo.css">
    <!-- 引入FontAwesome图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 引入WebRTC客户端脚本 -->
    <script src="client.js"></script>
</head>
<body>
    <!-- WebRTC 隐藏元素 -->
    <input id="use-stun" type="checkbox" style="display: none;" checked>
    <input type="hidden" id="sessionid">
    <audio id="audio" autoplay></audio>
    <video id="video" autoplay playsinline></video>

    <div id="screen">
        <div class="status">
            <div class="status-dot" id="status-dot"></div>
            <span id="status-text">语音助手已就绪</span>
        </div>
        
        <div class="connection-status" id="connection-status">
            WebRTC状态: 未连接
        </div>
        
        <div class="welcome-text">
            欢迎使用<span>智能语音助手</span><br>请点击下方工具栏开始交互
        </div>
        
        <div class="mic-animation" id="mic-animation">
            <i class="fas fa-microphone"></i>
        </div>
        
        <div class="side-text" id="left-text">
            <div class="subtitle-bubble" id="ai-subtitle">AI回复将在这里显示...</div>
        </div>
        
        <div class="side-text" id="right-text">
            <div class="subtitle-bubble" id="user-subtitle">用户语音识别结果将在这里显示...</div>
        </div>
        
        <!-- 新增：即时语音交互设置 -->
        <div class="instant-settings" id="instant-settings">
            <div class="instant-panel">
                <div class="instant-item">
                    <label>RAG模式</label>
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="instant-rag-switch">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="instant-item">
                    <label for="instant-kb-select">知识库</label>
                    <select id="instant-kb-select">
                        <option value="">无</option>
                    </select>
                </div>
                <div class="instant-item">
                    <label for="instant-voice-select">音色</label>
                    <select id="instant-voice-select">
                        <option value="">默认音色</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    
    <div id="toolbar-container">
        <div id="toolbar">
            <button class="tool-btn" id="mic-btn">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="tool-btn" id="start-btn">
                <i class="fas fa-play"></i>
            </button>
            <button class="tool-btn" id="settings-btn">
                <i class="fas fa-cog"></i>
            </button>
            <button class="tool-btn" id="toggle-subtitle-btn">
                <i class="fas fa-font"></i>
            </button>
            <button class="tool-btn" id="book-btn">
                <i class="fas fa-book"></i>
            </button>
        </div>
    </div>
    
    <div id="settings-panel">
        <div class="panel-header">
            <h2>系统设置</h2>
            <button class="close-btn" id="close-panel">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="settings-section">
            <div class="section-header">
                <h3>RAG知识库设置</h3>
                <div class="section-actions">
                    <button class="action-btn" id="create-kb-btn">创建</button>
                    <button class="action-btn" id="delete-kb-btn">删除</button>
                    <button class="action-btn" id="switch-kb-btn">切换</button>
            </div>
                </div>
            <div class="settings-content">
                <div class="settings-item">
                    <label for="kb-select">当前知识库</label>
                    <select id="kb-select" style="width: 100%; margin-top: 5px;">
                    <option value="">无</option>
                </select>
                </div>
                <div class="settings-item">
                    <label for="kb-name">新建知识库名称</label>
                    <input type="text" id="kb-name" placeholder="3-20位英文/数字" style="width: 100%; margin-top: 5px;">
                </div>
                <div class="settings-item">
                    <label for="kb-file">上传文件</label>
                    <input type="file" id="kb-file" style="width: 100%; margin-top: 5px;">
                </div>
                <div class="settings-item">
                    <label for="rag-prompt">RAG提示词</label>
                </div>
                <textarea id="rag-prompt" placeholder="请输入RAG提示词...">基于提供的上下文信息，准确、简洁地回答用户问题。如果信息不足，请说明无法回答。</textarea>
                <div class="settings-item">
                    <label>WebRTC连接状态</label>
                    <div id="webrtc-status" style="color: #f44336;">未连接</div>
                </div>
            </div>
        </div>
        
        <div class="settings-section">
            <div class="section-header">
                <h3>FishTTS声音克隆</h3>
                <div class="section-actions">
                    <button class="action-btn" id="upload-voice-btn">上传</button>
                    <button class="action-btn" id="delete-voice-btn">删除</button>
                    <button class="action-btn" id="refresh-voice-btn">刷新</button>
                </div>
            </div>
            <div class="settings-content">
                <div class="settings-item">
                    <label for="voice-name-input">新音源名称</label>
                    <input type="text" id="voice-name-input" placeholder="3-20位英文/数字">
                </div>
                <div class="settings-item">
                    <label for="voice-file-input">音频文件</label>
                    <input type="file" id="voice-file-input" accept="audio/*">
                </div>
                <div class="settings-item">
                    <label for="voice-list-select">可用音源</label>
                    <select id="voice-list-select">
                        <option value="">默认音色</option>
                    </select>
                </div>
                <div id="voice-status" style="font-size: 12px; color: #666; margin-top: 10px;">加载中...</div>
            </div>
        </div>
        
        <div class="settings-section">
            <div class="section-header">
                <h3>数字人管理</h3>
                <div class="section-actions">
                    <button class="action-btn" id="create-avatar-btn">创建</button>
                    <button class="action-btn" id="switch-avatar-btn">切换</button>
                    <button class="action-btn" id="delete-avatar-btn">删除</button>
                </div>
            </div>
            <div class="settings-content">
                <div class="settings-item">
                    <label for="avatar-select">当前数字人</label>
                    <select id="avatar-select">
                        <option value="">选择数字人</option>
                    </select>
                </div>
                <div class="settings-item">
                    <label for="avatar-file-input">数字人素材</label>
                    <input type="file" id="avatar-file-input" accept="image/*,video/*,.zip">
                </div>
                <div class="settings-item">
                    <label for="avatar-id-input">数字人ID（可选）</label>
                    <input type="text" id="avatar-id-input" placeholder="如：xiaoli0001">
                </div>
                <div class="settings-item">
                    <label for="avatar-delete-select">删除数字人</label>
                    <select id="avatar-delete-select">
                        <option value="">选择要删除的数字人</option>
                </select>
                </div>
                <div id="avatar-status" style="font-size: 12px; color: #666; margin-top: 10px;">加载中...</div>
            </div>
        </div>
        
        <div class="settings-section">
            <div class="section-header">
                <h3>LLM 设置</h3>
                <div class="section-actions">
                    <button class="action-btn" id="switch-llm-btn">切换</button>
                    <button class="action-btn" id="test-llm-btn">测试</button>
                    <button class="action-btn" id="refresh-llm-btn">刷新</button>
                </div>
            </div>
            <div class="settings-content">
                <div class="settings-item">
                    <label for="llm-provider-select">LLM 提供商</label>
                    <select id="llm-provider-select">
                        <option value="ollama">Ollama</option>
                        <option value="deepseek">DeepSeek</option>
                    </select>
                </div>
                <div id="llm-status" style="font-size: 12px; color: #666; margin-top: 10px;">当前: Ollama</div>
            </div>
        </div>
        
        <div class="settings-section">
            <div class="section-header">
                <h3>使用说明</h3>
            </div>
            <div class="settings-content">
                <div style="color: rgba(255, 255, 255, 0.8); font-size: 14px; line-height: 1.6;">
                    <p><strong>操作步骤：</strong></p>
                    <p>1. 点击播放按钮建立WebRTC连接</p>
                    <p>2. 点击麦克风按钮开始语音交互</p>
                    <p>3. 点击文本按钮进行文字输入</p>
                    <p><strong>快捷键：</strong></p>
                    <p>• 空格键：开始录音</p>
                    <p>• ESC键：停止录音</p>
                    <p><strong>字幕说明：</strong></p>
                    <p>• 左侧绿色：AI回复内容</p>
                    <p>• 右侧黄色：用户输入内容</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">操作成功！</div>
    
    <!-- ASR结果显示区域 -->
    <div id="asr-result" style="position: absolute; bottom: 100px; right: 20px; background: rgba(255, 193, 7, 0.1); border: 1px solid #ffc107; border-radius: 8px; padding: 10px; color: #ffc107; max-width: 300px; opacity: 0; transition: opacity 0.3s ease; z-index: 50;">
        <div style="font-size: 12px; margin-bottom: 5px;">语音识别结果:</div>
        <div id="asr-text"></div>
    </div>

    <!-- 引入外部JavaScript文件 -->
    <script src="demo.js"></script>

</body>
</html>